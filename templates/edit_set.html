{% extends 'base.html' %}

{% block content %}
<div class="edit-set-container">

    <h2>Edit Flashcard Set</h2>

    {% if message %}
    <p class="success-message">{{ message }}</p>
    {% endif %}

    <!-- ========================= -->
    <!-- Edit Set Title -->
    <!-- ========================= -->
    <form method="POST" class="edit-set-form">
        {{ set_form.hidden_tag() }}

        <div class="form-group">
            {{ set_form.title.label }}
            {{ set_form.title(class="form-control") }}
        </div>

        <div class="form-buttons">
            {{ set_form.submit(class="btn btn-primary") }}
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Sets</a>
        </div>
    </form>

    <hr>

    <!-- ========================= -->
    <!-- Add Question Inline -->
    <!-- ========================= -->
    <a id="add-question"></a>
    <h3>Add a Question</h3>

    <form method="POST" id="add-question-form">
        {{ question_form.hidden_tag() }}

        <div class="form-group">
            {{ question_form.question_text.label }}
            {{ question_form.question_text(rows=4, class="form-control", id="question_text") }}
        </div>

        <div class="form-group">
            {{ question_form.option_a.label }}
            {{ question_form.option_a(class="form-control") }}
        </div>

        <div class="form-group">
            {{ question_form.option_b.label }}
            {{ question_form.option_b(class="form-control") }}
        </div>

        <div class="form-group">
            {{ question_form.option_c.label }}
            {{ question_form.option_c(class="form-control") }}
        </div>

        <div class="form-group">
            {{ question_form.option_d.label }}
            {{ question_form.option_d(class="form-control") }}
        </div>

        <div class="form-group">
            {{ question_form.correct_option.label }}
            {{ question_form.correct_option(class="form-control") }}
        </div>

        <div class="form-group">
            {{ question_form.continue_adding() }}
            {{ question_form.continue_adding.label }}
        </div>

        <button type="submit" class="btn btn-primary">
            Add Question
        </button>
    </form>

    <hr>

    <!-- ========================= -->
    <!-- Question Cards -->
    <!-- ========================= -->
    <h3>Questions</h3>

    <div class="question-cards">
        {% for question in set.questions %}
        <div class="question-card">
            <p><strong>Q{{ loop.index }}:</strong> {{ question.question_text }}</p>

            <ul>
                <li>A: {{ question.option_a }}</li>
                <li>B: {{ question.option_b }}</li>
                <li>C: {{ question.option_c }}</li>
                <li>D: {{ question.option_d }}</li>
            </ul>

            <p><strong>Correct:</strong> {{ question.correct_option }}</p>

            <div class="card-buttons">
                <a href="{{ url_for('edit_question', question_id=question.id) }}"
                   class="btn btn-sm btn-primary">Edit</a>

                <form method="POST"
                      action="{{ url_for('delete_question', question_id=question.id) }}"
                      style="display:inline;"
                      onsubmit="return confirm('Delete this question?');">
                    <button class="btn btn-sm btn-danger">Delete</button>
                </form>
            </div>
        </div>
        {% else %}
        <p>No questions yet.</p>
        {% endfor %}
    </div>

    <hr>

    <!-- ========================= -->
    <!-- Delete Set -->
    <!-- ========================= -->
    <form method="POST"
          action="{{ url_for('delete_set', set_id=set.id) }}"
          onsubmit="return confirm('Are you sure you want to delete this entire set? This cannot be undone.');">
        <button class="btn btn-danger">
            Delete This Set
        </button>
    </form>

</div>

<script>
document.addEventListener("keydown", function (e) {
    const form = document.getElementById("add-question-form");
    if (!form) return;

    const active = document.activeElement;

    // Only act if focus is inside the Add Question form
    if (!form.contains(active)) return;

    // Ctrl + Enter submits from anywhere
    if (e.key === "Enter" && e.ctrlKey) {
        e.preventDefault();
        form.requestSubmit();
    }
});
</script>


<!-- Auto-focus question field -->
<script>
    window.onload = function () {
        const box = document.getElementById("question_text");
        if (box) box.focus();
    };
</script>
{% endblock %}



